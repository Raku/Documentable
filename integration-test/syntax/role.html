<!doctype html>
<html lang="en">
<head>
    <title>syntax role</title>
    <meta charset="UTF-8"/>
    <meta name=viewport content="width=device-width, initial-scale=1">
    <link rel="icon" href="/Documentable/integration-test/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="/Documentable/integration-test/css/app.css" media="screen" title="default" />
    <noscript> <style> #search { visibility: hidden; } </style> </noscript>
</head>

<body class="pod">

    <div id="___top"></div>

    <div id="header" class="pretty-box green">

        <a href="/Documentable/integration-test/">
            <img src="/Documentable/integration-test/images/Camelia.svg"alt="»ö«"id="logo"width="62"height="48"/> &nbsp;Raku Documentation
        </a>

        <div id="search" class="ui-widget">
            <div class="green">
                <input placeholder="Loading..." id="query" accesskey="f" title="Enter term to search for (hit Esc to focus)"/>
            </div>
            <p id="not-found-message">
                Not in Index (<a href="" id="try-web-search">try site search</a>)
            </p>
        </div>
        
        <div class="menu">
            
            <div class="menu-items dark-green">
                <a class='menu-item darker-green' href='https://raku.org'><strong>Raku homepage</strong></a>
                    <a class="menu-item " href="/Documentable/integration-test/language.html"> Language </a>
                    <a class="menu-item " href="/Documentable/integration-test/type.html"> Types </a>
                    <a class="menu-item " href="/Documentable/integration-test/routine.html"> Routines </a>
                    <a class="menu-item " href="/Documentable/integration-test/programs.html"> Programs </a>
                    <a class="menu-item " href="https://webchat.freenode.net/?channels=#raku"> Chat with us </a>
            </div>
            
            
            
        
        </div>
    </div>

    <div id="content" class="pretty-box yellow content_fragment">

        <div align="right" style="display:none;">
            <button title="Edit this page"  class="pencil" onclick="location=''">
                <svg width="14px" height="16px" viewBox="0 0 14 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <defs></defs>
                    <g id="Octicons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <g id="pencil" fill="#000000">
                            <path d="M0,12 L0,15 L3,15 L11,7 L8,4 L0,12 L0,12 Z M3,14 L1,14 L1,12 L2,12 L2,13 L3,13 L3,14 L3,14 Z M13.3,4.7 L12,6 L9,3 L10.3,1.7 C10.69,1.31 11.32,1.31 11.71,1.7 L13.3,3.29 C13.69,3.68 13.69,4.31 13.3,4.7 L13.3,4.7 Z" id="Shape"></path>
                        </g>
                    </g>
                </svg>
            </button>
        </div>

        <h1 class="title">syntax role</h1>
        <p class="subtitle"></p>

        <nav class="indexgroup">
<table id="TOC">
<caption><h2 id="TOC_Title">Table of Contents</h2></caption>
    <tr class="toc-level-1"><td class="toc-number">1</td><td class="toc-text"><a href="#language_documentation_Object_orientation">language documentation Object orientation</a></td></tr>
   <tr class="toc-level-2"><td class="toc-number">1.1</td><td class="toc-text"><a href="#(Object_orientation)_declarator_role_role">(Object orientation) declarator role role</a></td></tr>
                                                                          <tr class="toc-level-2"><td class="toc-number">1.2</td><td class="toc-text"><a href="#Applying_roles">Applying roles</a></td></tr>
                                                                                                                          <tr class="toc-level-2"><td class="toc-number">1.3</td><td class="toc-text"><a href="#Stubs">Stubs</a></td></tr>
                                          <tr class="toc-level-2"><td class="toc-number">1.4</td><td class="toc-text"><a href="#Inheritance">Inheritance</a></td></tr>
                                      <tr class="toc-level-2"><td class="toc-number">1.5</td><td class="toc-text"><a href="#Pecking_order">Pecking order</a></td></tr>
                               <tr class="toc-level-2"><td class="toc-number">1.6</td><td class="toc-text"><a href="#Automatic_role_punning">Automatic role punning</a></td></tr>
                           <tr class="toc-level-2"><td class="toc-number">1.7</td><td class="toc-text"><a href="#Parameterized_roles">Parameterized roles</a></td></tr>
                                                                                     <tr class="toc-level-2"><td class="toc-number">1.8</td><td class="toc-text"><a href="#Mixins_of_roles">Mixins of roles</a></td></tr>
                                                                                    
</table>
</nav>

        <div class="pod-body ">
            <p>Documentation for syntax <code>role</code> assembled from the following types:</p>
<h1 id="language_documentation_Object_orientation"><a class="u" href="#___top" title="go to top of document">language documentation Object orientation</a></h1>
<p>From <a href="/Documentable/integration-test/language/objects#Roles">Object orientation</a></p>
<h2 id="(Object_orientation)_declarator_role_role"><a href="/Documentable/integration-test/language/objects#Roles">(Object orientation) declarator role role</a></h2>
<p>Roles are a collection of attributes and methods; however, unlike classes, roles are meant for describing only parts of an object&#39;s behavior; this is why, in general, roles are intended to be <em>mixed in</em> classes and objects. In general, classes are meant for managing objects and roles are meant for managing behavior and code reuse within objects.</p>
<p><a name="Documentable/integration-test/index-entry-does"></a> Roles use the keyword <code>role</code> preceding the name of the role that is declared. Roles are mixed in using the <code>does</code> keyword preceding the name of the role that is mixed in.</p>
<p>Roles can also be mixed into a class using <code>is</code>. However, the semantics of <code>is</code> with a role are quite different from those offered by <code>does</code>. With <code>is</code>, a class is punned from the role, and then inherited from. Thus, there is no flattening composition, and none of the safeties which <code>does</code> provides.</p>
<pre class="pod-block-code">constant ⲧ = &quot; &quot; xx 4; #Just a ⲧab
role Notable {
    has Str $.notes is rw;

    multi method notes() { &quot;$!notes\n&quot; };
    multi method notes( Str $note ) { $!notes ~= &quot;$note\n&quot; ~ ⲧ };

}

class Journey does Notable {
    has $.origin;
    has $.destination;
    has @.travelers;

    method Str { &quot;⤷ $!origin\n&quot; ~ ⲧ ~ self.notes() ~ &quot;$!destination ⤶\n&quot; };
}

my $trip = Journey.new( :origin&lt;Here&gt;, :destination&lt;There&gt;,
                        travelers =&gt; &lt;þor Freya&gt; );

$trip.notes(&quot;First steps&quot;);
notes $trip: &quot;Almost there&quot;;
print $trip;
# OUTPUT:
#⤷ Here
#       First steps
#       Almost there
#
#There ⤶
</pre>
<p>Roles are immutable as soon as the compiler parses the closing curly brace of the role declaration.</p>
<h2 id="Applying_roles"><a class="u" href="#___top" title="go to top of document">Applying roles</a></h2>
<p>Role application differs significantly from class inheritance. When a role is applied to a class, the methods of that role are copied into the class. If multiple roles are applied to the same class, conflicts (e.g. attributes or non-multi methods of the same name) cause a compile-time error, which can be solved by providing a method of the same name in the class.</p>
<p>This is much safer than multiple inheritance, where conflicts are never detected by the compiler, but are instead resolved to the superclass that appears earlier in the method resolution order, which might not be what the programmer wanted.</p>
<p>For example, if you&#39;ve discovered an efficient method to ride cows, and are trying to market it as a new form of popular transportation, you might have a class <code>Bull</code>, for all the bulls you keep around the house, and a class <code>Automobile</code>, for things that you can drive.</p>
<pre class="pod-block-code">class Bull {
    has Bool $.castrated = False;
    method steer {
        # Turn your bull into a steer
        $!castrated = True;
        return self;
    }
}
class Automobile {
    has $.direction;
    method steer($!direction) { }
}
class Taurus is Bull is Automobile { }

my $t = Taurus.new;
say $t.steer;
# OUTPUT: «Taurus.new(castrated =&gt; Bool::True, direction =&gt; Any)␤»
</pre>
<p>With this setup, your poor customers will find themselves unable to turn their Taurus and you won&#39;t be able to make more of your product! In this case, it may have been better to use roles:</p>
<pre class="pod-block-code">role Bull-Like {
    has Bool $.castrated = False;
    method steer {
        # Turn your bull into a steer
        $!castrated = True;
        return self;
    }
}
role Steerable {
    has Real $.direction;
    method steer(Real $d = 0) {
        $!direction += $d;
    }
}
class Taurus does Bull-Like does Steerable { }
</pre>
<p>This code will die with something like:</p>
<pre class="pod-block-code">===SORRY!===
Method &#39;steer&#39; must be resolved by class Taurus because it exists in
multiple roles (Steerable, Bull-Like)
</pre>
<p>This check will save you a lot of headaches:</p>
<pre class="pod-block-code">class Taurus does Bull-Like does Steerable {
    method steer($direction?) {
        self.Steerable::steer($direction)
    }
}
</pre>
<p>When a role is applied to a second role, the actual application is delayed until the second role is applied to a class, at which point both roles are applied to the class. Thus</p>
<pre class="pod-block-code">role R1 {
    # methods here
}
role R2 does R1 {
    # methods here
}
class C does R2 { }
</pre>
<p>produces the same class <code>C</code> as</p>
<pre class="pod-block-code">role R1 {
    # methods here
}
role R2 {
    # methods here
}
class C does R1 does R2 { }
</pre>
<h2 id="Stubs"><a class="u" href="#___top" title="go to top of document">Stubs</a></h2>
<p>When a role contains a stubbed method, that is, a method whose code is limited to <code>...</code>, a non-stubbed version of a method of the same name must be supplied at the time the role is applied to a class. This allows you to create roles that act as abstract interfaces.</p>
<pre class="pod-block-code">role AbstractSerializable {
    method serialize() { ... }        # literal ... here marks the
                                      # method as a stub
}

# the following is a compile time error, for example
#        Method &#39;serialize&#39; must be implemented by Point because
#        it&#39;s required by a role

class APoint does AbstractSerializable {
    has $.x;
    has $.y;
}

# this works:
class SPoint does AbstractSerializable {
    has $.x;
    has $.y;
    method serialize() { &quot;p($.x, $.y)&quot; }
}
</pre>
<p>The implementation of the stubbed method may also be provided by another role.</p>
<h2 id="Inheritance"><a class="u" href="#___top" title="go to top of document">Inheritance</a></h2>
<p>Roles cannot inherit from classes, but they may <em>carry</em> classes, causing any class which does that role to inherit from the carried classes. So if you write:</p>
<pre class="pod-block-code">role A is Exception { }
class X::Ouch does A { }
X::Ouch.^parents.say # OUTPUT: «((Exception))␤»
</pre>
<p>then <code>X::Ouch</code> will inherit directly from Exception, as we can see above by listing its parents.</p>
<p>As they do not use what can properly be called inheritance, roles are not part of the class hierarchy. Roles are listed with the <code>.^roles</code> metamethod instead, which uses <code>transitive</code> as flag for including all levels or just the first one. Despite this, a class or instance may still be tested with smartmatches or type constraints to see if it does a role.</p>
<pre class="pod-block-code">role F { }
class G does F { }
G.^roles.say;                    # OUTPUT: «((F))␤»
role Ur {}
role Ar does Ur {}
class Whim does Ar {}; Whim.^roles(:!transitive).say;   # OUTPUT: «((Ar))␤»
say G ~~ F;                      # OUTPUT: «True␤»
multi a (F $a) { &quot;F&quot;.say }
multi a ($a)   { &quot;not F&quot;.say }
a(G);                            # OUTPUT: «F␤»
</pre>
<h2 id="Pecking_order"><a class="u" href="#___top" title="go to top of document">Pecking order</a></h2>
<p>A method defined directly in a class will always override definitions from applied roles or from inherited classes. If no such definition exists, methods from roles override methods inherited from classes. This happens both when said class was brought in by a role, and also when said class was inherited directly.</p>
<pre class="pod-block-code">role M {
  method f { say &quot;I am in role M&quot; }
}

class A {
  method f { say &quot;I am in class A&quot; }
}

class B is A does M {
  method f { say &quot;I am in class B&quot; }
}

class C is A does M { }

B.new.f; # OUTPUT «I am in class B␤»
C.new.f; # OUTPUT «I am in role M␤»
</pre>
<p>Note that each candidate for a multi-method is its own method. In this case, the above only applies if two such candidates have the same signature. Otherwise, there is no conflict, and the candidate is just added to the multi-method.</p>
<h2 id="Automatic_role_punning"><a class="u" href="#___top" title="go to top of document">Automatic role punning</a></h2>
<p>Any attempt to directly instantiate a role or use it as a type object will automatically create a class with the same name as the role, making it possible to transparently use a role as if it were a class.</p>
<pre class="pod-block-code">role Point {
    has $.x;
    has $.y;
    method abs { sqrt($.x * $.x + $.y * $.y) }
    method dimensions { 2 }
}
say Point.new(x =&gt; 6, y =&gt; 8).abs; # OUTPUT «10␤»
say Point.dimensions;              # OUTPUT «2␤»
</pre>
<p>We call this automatic creation of classes <em>punning</em>, and the generated class a <em>pun</em>.</p>
<p>Punning is not caused by most <a href="/Documentable/integration-test/language/mop">metaprogramming</a> constructs, however, as those are sometimes used to work directly with roles.</p>
<p><a name="Documentable/integration-test/index-entry-Parameterized_Roles"></a></p>
<h2 id="Parameterized_roles"><a class="u" href="#___top" title="go to top of document">Parameterized roles</a></h2>
<p>Roles can be parameterized, by giving them a signature in square brackets:</p>
<pre class="pod-block-code">role BinaryTree[::Type] {
    has BinaryTree[Type] $.left;
    has BinaryTree[Type] $.right;
    has Type $.node;

    method visit-preorder(&amp;cb) {
        cb $.node;
        for $.left, $.right -&gt; $branch {
            $branch.visit-preorder(&amp;cb) if defined $branch;
        }
    }
    method visit-postorder(&amp;cb) {
        for $.left, $.right -&gt; $branch {
            $branch.visit-postorder(&amp;cb) if defined $branch;
        }
        cb $.node;
    }
    method new-from-list(::?CLASS:U: *@el) {
        my $middle-index = @el.elems div 2;
        my @left         = @el[0 .. $middle-index - 1];
        my $middle       = @el[$middle-index];
        my @right        = @el[$middle-index + 1 .. *];
        self.new(
            node    =&gt; $middle,
            left    =&gt; @left  ?? self.new-from-list(@left)  !! self,
            right   =&gt; @right ?? self.new-from-list(@right) !! self,
        );
    }
}

my $t = BinaryTree[Int].new-from-list(4, 5, 6);
$t.visit-preorder(&amp;say);    # OUTPUT: «5␤4␤6␤»
$t.visit-postorder(&amp;say);   # OUTPUT: «4␤6␤5␤»
</pre>
<p>Here the signature consists only of a type capture, but any signature will do:</p>
<pre class="pod-block-code">enum Severity &lt;debug info warn error critical&gt;;

role Logging[$filehandle = $*ERR] {
    method log(Severity $sev, $message) {
        $filehandle.print(&quot;[{uc $sev}] $message\n&quot;);
    }
}

Logging[$*OUT].log(debug, &#39;here we go&#39;); # OUTPUT: «[DEBUG] here we go␤»
</pre>
<p>You can have multiple roles of the same name, but with different signatures; the normal rules of multi dispatch apply for choosing multi candidates.</p>
<p><a name="Documentable/integration-test/index-entry-but"></a></p>
<h2 id="Mixins_of_roles"><a class="u" href="#___top" title="go to top of document"><a name="Documentable/integration-test/index-entry-Mixins"><span class="index-entry">Mixins</span></a> of roles</a></h2>
<p>Roles can be mixed into objects. A role&#39;s given attributes and methods will be added to the methods and attributes the object already has. Multiple mixins and anonymous roles are supported.</p>
<pre class="pod-block-code">role R { method Str() {&#39;hidden!&#39;} };
my $i = 2 but R;
sub f(\bound){ put bound };
f($i); # OUTPUT: «hidden!␤»
my @positional := &lt;a b&gt; but R;
say @positional.^name; # OUTPUT: «List+{R}␤»
</pre>
<p>Note that the object got the role mixed in, not the object&#39;s class or the container. Thus, @-sigiled containers will require binding to make the role stick as is shown in the example with <code>@positional</code>. Some operators will return a new value, which effectively strips the mixin from the result. That is why it might be more clear to mix in the role in the declaration of the variable using <code>does</code>:</p>
<pre class="pod-block-code">role R {};
my @positional does R = &lt;a b&gt;;
say @positional.^name; # OUTPUT: «Array+{R}␤»
</pre>
<p>The operator <code>infix:&lt;but&gt;</code> is narrower than the list constructor. When providing a list of roles to mix in, always use parentheses.</p>
<pre class="pod-block-code">role R1 { method m {} }
role R2 { method n {} }
my $a = 1 but R1,R2; # R2 is in sink context, issues a WARNING
say $a.^name;
# OUTPUT: «Int+{R1}␤»
my $all-roles = 1 but (R1,R2);
say $all-roles.^name; # OUTPUT: «Int+{R1,R2}␤»
</pre>
<p>Mixins can be used at any point in your object&#39;s life.</p>
<pre class="pod-block-code"># A counter for Table of Contents
role TOC-Counter {
    has Int @!counters is default(0);
    method Str() { @!counters.join: &#39;.&#39; }
    method inc($level) {
        @!counters[$level - 1]++;
        @!counters.splice($level);
        self
    }
}

my Num $toc-counter = NaN;     # don&#39;t do math with Not A Number
say $toc-counter;              # OUTPUT: «NaN␤»
$toc-counter does TOC-Counter; # now we mix the role in
$toc-counter.inc(1).inc(2).inc(2).inc(1).inc(2).inc(2).inc(3).inc(3);
put $toc-counter / 1;          # OUTPUT: «NaN␤» (because that&#39;s numerical context)
put $toc-counter;              # OUTPUT: «2.2.2␤» (put will call TOC-Counter::Str)
</pre>
<p>Roles can be anonymous.</p>
<pre class="pod-block-code">my %seen of Int is default(0 but role :: { method Str() {&#39;NULL&#39;} });
say %seen&lt;not-there&gt;;          # OUTPUT: «NULL␤»
say %seen&lt;not-there&gt;.defined;  # OUTPUT: «True␤» (0 may be False but is well defined)
say Int.new(%seen&lt;not-there&gt;); # OUTPUT: «0␤»
</pre>

        </div>
    </div>

    

    <footer class="pretty-box yellow">
        <p>
            Generated from <a href="https://github.com/Raku/doc/blob/master/doc/">https://github.com/Raku/doc/blob/master/doc/</a>.
        </p>
        <p>
            This is a work in progress to document Raku (formerly known as Perl 6), and
            known to be incomplete.
        </p>
        <p>
            <a href="https://github.com/raku/doc/blob/master/CONTRIBUTING.md#reporting-bugs">
                Please report any issues
            </a>
            Your contribution is appreciated.
        </p>
        <p>
            This documentation is provided under the terms of the
            <a href="https://raw.githubusercontent.com/raku/doc/master/LICENSE">
                Artistic License 2.0
            </a>. The Camelia image is
            <a href="https://raw.githubusercontent.com/raku/mu/master/misc/camelia.txt">
                copyright © 2009 by Larry Wall.
            </a>
            <!-- CREDITS -->
            <!--External Link Image by Zapyon, CCA-SA 4.0. Derived from Wikimedia Foundation https://commons.wikimedia.org/wiki/File:External-link-04-bold-12x12.svg -->
        </p>
    </footer>

    <script type="text/javascript" src="/Documentable/integration-test/js/app.js?v=1"></script>
    <script type="text/javascript" src="/Documentable/integration-test/js/search.js?v=3"></script>
</body>
</html>

