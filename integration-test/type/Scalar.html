<!doctype html>
<html lang="en">
<head>
    <title>class Scalar</title>
    <meta charset="UTF-8"/>
    <meta name=viewport content="width=device-width, initial-scale=1">
    <link rel="icon" href="/Documentable/integration-test/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="/Documentable/integration-test/css/app.css" media="screen" title="default" />
    <noscript> <style> #search { visibility: hidden; } </style> </noscript>
</head>

<body class="pod">

    <div id="___top"></div>

    <div id="header" class="pretty-box green">

        <a href="/Documentable/integration-test/">
            <img src="/Documentable/integration-test/images/Camelia.svg"alt="»ö«"id="logo"width="62"height="48"/> &nbsp;Raku Documentation
        </a>

        <div id="search" class="ui-widget">
            <div class="green">
                <input placeholder="Loading..." id="query" accesskey="f" title="Enter term to search for (hit Esc to focus)"/>
            </div>
            <p id="not-found-message">
                Not in Index (<a href="" id="try-web-search">try site search</a>)
            </p>
        </div>
        
        <div class="menu">
            
            <div class="menu-items dark-green">
                <a class='menu-item darker-green' href='https://raku.org'><strong>Raku homepage</strong></a>
                    <a class="menu-item " href="/Documentable/integration-test/language.html"> Language </a>
                    <a class="menu-item selected darker-green" href="/Documentable/integration-test/type.html"> Types </a>
                    <a class="menu-item " href="/Documentable/integration-test/routine.html"> Routines </a>
                    <a class="menu-item " href="/Documentable/integration-test/programs.html"> Programs </a>
                    <a class="menu-item " href="https://webchat.freenode.net/?channels=#raku"> Chat with us </a>
            </div>
            
            <div class="menu-items darker-green"><div class="menu-items darker-green"><div class="menu-items darker-green"><div class="menu-items darker-green"><div class="menu-items darker-green">
                    <a class="menu-item" href="/Documentable/integration-test/type.html"> All </a>
                    <a class="menu-item" href="/Documentable/integration-test/type-basic.html"> Basic </a>
                    <a class="menu-item" href="/Documentable/integration-test/type-composite.html"> Composite </a>
                    <a class="menu-item" href="/Documentable/integration-test/type-domain-specific.html"> Domain-specific </a>
                    <a class="menu-item" href="/Documentable/integration-test/type-exception.html"> Exceptions </a>
            </div></div></div></div></div>
        
        </div>
    </div>

    <div id="content" class="pretty-box yellow content_fragment">

        <div align="right" style="display:;">
            <button title="Edit this page"  class="pencil" onclick="location='https://github.com/Raku/doc/edit/master/doc/Type/Scalar.pod6'">
                <svg width="14px" height="16px" viewBox="0 0 14 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <defs></defs>
                    <g id="Octicons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <g id="pencil" fill="#000000">
                            <path d="M0,12 L0,15 L3,15 L11,7 L8,4 L0,12 L0,12 Z M3,14 L1,14 L1,12 L2,12 L2,13 L3,13 L3,14 L3,14 Z M13.3,4.7 L12,6 L9,3 L10.3,1.7 C10.69,1.31 11.32,1.31 11.71,1.7 L13.3,3.29 C13.69,3.68 13.69,4.31 13.3,4.7 L13.3,4.7 Z" id="Shape"></path>
                        </g>
                    </g>
                </svg>
            </button>
        </div>

        <h1 class="title">class Scalar</h1>
        <p class="subtitle">A mostly transparent container used for indirections</p>

        <nav class="indexgroup">
<table id="TOC">
<caption><h2 id="TOC_Title">Table of Contents</h2></caption>
                                                                                                 <tr class="toc-level-1"><td class="toc-number">1</td><td class="toc-text"><a href="#Atomic_operations_on_Scalar">Atomic operations on Scalar</a></td></tr>
                  <tr class="toc-level-1"><td class="toc-number">2</td><td class="toc-text"><a href="#Introspection">Introspection</a></td></tr>
 <tr class="toc-level-2"><td class="toc-number">2.1</td><td class="toc-text"><a href="#method_of">method of</a></td></tr>
     <tr class="toc-level-2"><td class="toc-number">2.2</td><td class="toc-text"><a href="#method_default">method default</a></td></tr>
     <tr class="toc-level-2"><td class="toc-number">2.3</td><td class="toc-text"><a href="#method_name">method name</a></td></tr>
     <tr class="toc-level-2"><td class="toc-number">2.4</td><td class="toc-text"><a href="#method_dynamic">method dynamic</a></td></tr>
           <tr class="toc-level-1"><td class="toc-number">3</td><td class="toc-text"><a href="#Routines">Routines</a></td></tr>
 <tr class="toc-level-2"><td class="toc-number">3.1</td><td class="toc-text"><a href="#sub_atomic-assign">sub atomic-assign</a></td></tr>
            <tr class="toc-level-2"><td class="toc-number">3.2</td><td class="toc-text"><a href="#sub_atomic-fetch">sub atomic-fetch</a></td></tr>
             <tr class="toc-level-2"><td class="toc-number">3.3</td><td class="toc-text"><a href="#sub_cas">sub cas</a></td></tr>
                                        <tr class="toc-level-1"><td class="toc-number">4</td><td class="toc-text"><a href="#Operators">Operators</a></td></tr>
 <tr class="toc-level-2"><td class="toc-number">4.1</td><td class="toc-text"><a href="#infix_⚛=">infix ⚛=</a></td></tr>
           <tr class="toc-level-2"><td class="toc-number">4.2</td><td class="toc-text"><a href="#prefix_⚛">prefix ⚛</a></td></tr>
             <tr class="toc-level-1"><td class="toc-number">5</td><td class="toc-text"><a href="#Type_Graph">Type Graph</a></td></tr>
 
</table>
</nav>

        <div class="pod-body ">
            <pre class="pod-block-code">class Scalar {}</pre>
<p>A <code>Scalar</code> is an internal indirection which is for most purposes invisible during ordinary use of Raku. It is the default container type associated with the <code>$</code> sigil. A literal <code>Scalar</code> may be placed around a literal value by enclosing the value in <code>$(…)</code>. This notation will appear in the output of a <code>.raku</code> method in certain places where it is important to note the presence of <code>Scalar</code>s.</p>
<p>When a value is assigned to a <code>$</code>-sigiled variable, the variable will actually bind to a <code>Scalar</code>, which in turn will bind to the value. When a <code>Scalar</code> is assigned to a <code>$</code>-sigiled variable, the value bound to by that <code>Scalar</code> will be bound to the <code>Scalar</code> which that variable was bound to (a new one will be created if necessary.)</p>
<p>In addition, <code>Scalar</code>s delegate all method calls to the value which they contain. As such, <code>Scalar</code>s are for the most part invisible. There is, however, one important place where <code>Scalar</code>s have a visible impact: a <code>Scalar</code> will shield its content from flattening by most Raku core list operations.</p>
<p>A <code>$</code>-sigiled variable may be bound directly to a value with no intermediate <code>Scalar</code> using the binding operator <code>:=</code>. You can tell if this has been done by examining the output of the introspective pseudo-method <code>.VAR</code>:</p>
<pre class="pod-block-code">my $a = 1;
$a.^name.say;     # OUTPUT: «Int␤»
$a.VAR.^name.say; # OUTPUT: «Scalar␤»
my $b := 1;
$b.^name.say;     # OUTPUT: «Int␤»
$b.VAR.^name.say; # OUTPUT: «Int␤»</pre>
<p>This same thing happens when values are assigned to an element of an <code>Array</code>, however, <code>List</code>s directly contain their values:</p>
<pre class="pod-block-code">my @a = 1, 2, 3;
@a[0].^name.say;            # OUTPUT: «Int␤»
@a[0].VAR.^name.say;        # OUTPUT: «Scalar␤»
[1, 2, 3][0].^name.say;     # OUTPUT: «Int␤»
[1, 2, 3][0].VAR.^name.say; # OUTPUT: «Scalar␤»
(1, 2, 3)[0].^name.say;     # OUTPUT: «Int␤»
(1, 2, 3)[0].VAR.^name.say; # OUTPUT: «Int␤»</pre>
<p>Array elements may be bound directly to values using <code>:=</code> as well; however, this is discouraged as it may lead to confusion. Doing so will break exact round-tripping of <code>.raku</code> output – since <code>Array</code>s are assumed to place <code>Scalar</code>s around each element, <code>Scalar</code>s are not denoted with <code>$</code> in the output of <code>Array.raku</code>.</p>
<pre class="pod-block-code">[1, $(2, 3)].raku.say;     # OUTPUT: «[1, (2, 3)]␤»
(1, $(2, 3)).raku.say;     # OUTPUT: «(1, $(2, 3))␤»</pre>
<p>Binding a <code>Scalar</code> to a <code>$</code>-sigiled variable replaces the existing <code>Scalar</code> in that variable, if any, with the given <code>Scalar</code>. That means more than one variable may refer to the same <code>Scalar</code>. Because the <code>Scalar</code> may be mutated, this makes it possible to alter the value of both variables by altering only one of them:</p>
<pre class="pod-block-code">my $a = 1;
my $b := $a;
$b = 2;
$a.say;       # OUTPUT: «2␤»</pre>
<p><a name="Documentable/integration-test/index-entry-\_(sigilless_scalar)"></a> SSA-style constants bind directly to their value with no intervening <code>Scalar</code>, even when assignment (<code>=</code>) is used. They may be forced to use a <code>Scalar</code> by assigning a <code>$</code>-sigiled variable to them, at which point, they behave entirely like <code>$</code>-sigiled variables.</p>
<pre class="pod-block-code">my \c = 1;
c.^name.say;             # OUTPUT: «Int␤»
c.VAR.^name.say;         # OUTPUT: «Int␤»
my $a = 1;
my \d = $a;              # just &quot;my \d = $ = 1&quot; works, too
d.^name.say;             # OUTPUT: «Int␤»
d.VAR.^name.say;         # OUTPUT: «Scalar␤»
d = 2;                   # ok
c = 2;                   # fails
CATCH { default { put .^name, &#39;: &#39;, .Str } };
# OUTPUT: «X::Assignment::RO: Cannot modify an immutable Int␤»</pre>
<h1 id="Atomic_operations_on_Scalar"><a class="u" href="#___top" title="go to top of document">Atomic operations on Scalar</a></h1>
<p>A <code>Scalar</code> can have its value changed using a hardware-supported atomic compare and swap operation. This is useful when implementing lock free data structures and algorithms. It may also be fetched and assigned to in an &quot;atomic&quot; fashion, which ensures appropriate memory barriering and prevents unwanted optimizations of memory accesses.</p>
<p>A <code>Scalar</code> that will be used with an atomic operation should <strong>always</strong> be explicitly initialized with a value before any atomic operations are performed upon it. This is to avoid races with lazy allocation and auto-vivification. For example:</p>
<pre class="pod-block-code">cas(@a[5], $expected, $value)
</pre>
<p>Will work in principle since an <code>Array</code> consists of <code>Scalar</code> containers. However, the container is only bound into the array upon initial assignment. Therefore, there would be a race to do that binding. The <code>Scalar</code> atomic operations will never check for or do any such auto-vivification, so as to make such bugs much more evident (rather than only observed under stress).</p>
<h1 id="Introspection"><a class="u" href="#___top" title="go to top of document">Introspection</a></h1>
<h2 id="method_of"><a class="u" href="#___top" title="go to top of document">method of</a></h2>
<pre class="pod-block-code">method of(Scalar:D: --&gt; Mu)</pre>
<p>Returns the type constraint of the container.</p>
<p>Example:</p>
<pre class="pod-block-code">my Cool $x = 42;
say $x.VAR.of;                  # OUTPUT: «(Cool)»</pre>
<h2 id="method_default"><a class="u" href="#___top" title="go to top of document">method default</a></h2>
<pre class="pod-block-code">method default(Scalar:D: --&gt; Str)</pre>
<p>Returns the default value associated with the container.</p>
<p>Example:</p>
<pre class="pod-block-code">my $x is default(666) = 42;
say $x.VAR.default;             # OUTPUT: «666»</pre>
<h2 id="method_name"><a class="u" href="#___top" title="go to top of document">method name</a></h2>
<pre class="pod-block-code">method name(Scalar:D: --&gt; Str)</pre>
<p>Returns the name associated with the container.</p>
<p>Example:</p>
<pre class="pod-block-code">my $x = 42;
say $x.VAR.name;                # OUTPUT: «$x»</pre>
<h2 id="method_dynamic"><a class="u" href="#___top" title="go to top of document">method dynamic</a></h2>
<pre class="pod-block-code">method dynamic(Scalar:D: --&gt; Bool)</pre>
<p>It will return <code>False</code> for scalars.</p>
<p>Example:</p>
<pre class="pod-block-code">my $*FOO = 42;
say $*FOO.VAR.dynamic;          # OUTPUT: «True»</pre>
<p>Note that you have to use the <code>VAR</code> method in order to get that information.</p>
<pre class="pod-block-code">my $s is dynamic = [1, 2, 3];
say $s.dynamic;                          # OUTPUT: «False␤»  (wrong, don&#39;t do this)
say $s.VAR.dynamic;                      # OUTPUT: «True␤»   (correct approach)</pre>
<h1 id="Routines"><a class="u" href="#___top" title="go to top of document">Routines</a></h1>
<h2 id="sub_atomic-assign"><a class="u" href="#___top" title="go to top of document">sub atomic-assign</a></h2>
<p>Defined as:</p>
<pre class="pod-block-code">multi sub atomic-assign($target is rw, $value)</pre>
<p>Performs an atomic assignment of <code>$value</code> into the <code>Scalar</code> <code>$target</code>. The <code>atomic-assign</code> routine ensures that any required barriers are performed such that the changed value will be &quot;published&quot; to other threads.</p>
<h2 id="sub_atomic-fetch"><a class="u" href="#___top" title="go to top of document">sub atomic-fetch</a></h2>
<pre class="pod-block-code">multi sub atomic-fetch($target is rw)</pre>
<p>Performs an atomic read of the value in the <code>Scalar</code> <code>$target</code> and returns the read value. Using this routine instead of simply using the variable ensures that the latest update to the variable from other threads will be seen, both by doing any required hardware barriers and also preventing the compiler from lifting reads. For example:</p>
<pre class="pod-block-code">my $started = False;
start { atomic-assign($started, True) }
until atomic-fetch($started) { }</pre>
<p>Is certain to terminate, while in:</p>
<pre class="pod-block-code">my $started = False;
start { atomic-assign($started, True) }
until $started { }</pre>
<p>It would be legal for a compiler to observe that <code>$started</code> is not updated in the loop, and so lift the read out of the loop, thus causing the program to never terminate.</p>
<h2 id="sub_cas"><a class="u" href="#___top" title="go to top of document">sub cas</a></h2>
<p>Defined as:</p>
<pre class="pod-block-code">multi sub cas($target is rw, $expected, $value)
multi sub cas($target is rw, &amp;operation)</pre>
<p>Performs an atomic compare and swap of the value in the <code>Scalar</code> <code>$target</code>. The first form has semantics like:</p>
<pre class="pod-block-code">my $seen = $target;
if $seen&lt;&gt; =:= $expected&lt;&gt; {
    $target = $value;
}
return $seen;
</pre>
<p>Except it is performed as a single hardware-supported atomic instruction, as if all memory access to <code>$target</code> were blocked while it took place. Therefore it is safe to attempt the operation from multiple threads without any other synchronization. Since it is a reference comparison, this operation is usually not sensible on value types.</p>
<p>For example:</p>
<pre class="pod-block-code">constant NOT_STARTED = Any.new;
constant STARTED = Any.new;
my $master = NOT_STARTED;
await start {
    if cas($master, NOT_STARTED, STARTED) === NOT_STARTED {
        say &quot;Master!&quot;
    }
} xx 4</pre>
<p>Will reliably only ever print <code>Master!</code> one time, as only one of the threads will be successful in changing the <code>Scalar</code> from <code>NOT_STARTED</code> to <code>STARTED</code>.</p>
<p>The second form, taking a code object, will first do an atomic fetch of the current value and invoke the code object with it. It will then try to do an atomic compare and swap of the target, using the value passed to the code object as <code>$expected</code> and the result of the code object as <code>$value</code>. If this fails, it will read the latest value, and retry, until a CAS operation succeeds.</p>
<p>Therefore, an item could be added to the head of a linked list in a lock free manner as follows:</p>
<pre class="pod-block-code">class Node {
    has $.value;
    has Node $.next;
}
my Node $head = Node;
await start {
    for ^1000 -&gt; $value {
        cas $head, -&gt; $next { Node.new(:$value, :$next) }
    }
} xx 4;</pre>
<p>This will reliably build up a linked list of 4000 items, with 4 nodes with each value ranging from 0 up to 999.</p>
<h1 id="Operators"><a class="u" href="#___top" title="go to top of document">Operators</a></h1>
<h2 id="infix_⚛="><a class="u" href="#___top" title="go to top of document">infix ⚛=</a></h2>
<pre class="pod-block-code">multi sub infix:&lt;⚛=&gt;($target is rw, $value)</pre>
<p>Performs an atomic assignment of <code>$value</code> into the <code>Scalar</code> <code>$target</code>. The <code>⚛=</code> operator ensures that any required barriers are performed such that the changed value will be &quot;published&quot; to other threads.</p>
<h2 id="prefix_⚛"><a class="u" href="#___top" title="go to top of document">prefix ⚛</a></h2>
<pre class="pod-block-code">multi sub prefix:&lt;⚛&gt;($target is rw)</pre>
<p>Performs an atomic read of the value in the <code>Scalar</code> <code>$target</code> and returns the read value. Using this operator instead of simply using the variable ensures that the latest update to the variable from other threads will be seen, both by doing any required hardware barriers and also preventing the compiler from lifting reads. For example:</p>
<pre class="pod-block-code">my $started = False;
start { $started ⚛= True }
until ⚛$started { }</pre>
<p>Is certain to terminate, while in:</p>
<pre class="pod-block-code">my $started = False;
start { $started ⚛= True }
until $started { }</pre>
<p>It would be legal for a compiler to observe that <code>$started</code> is not updated in the loop, and so lift the read out of the loop, thus causing the program to never terminate.</p>
<h1 id="Type_Graph"><a class="u" href="#___top" title="go to top of document">Type Graph</a></h1>
<figure>
  <figcaption>Type relations for <code>Scalar</code></figcaption>
  <svg width="89pt" height="188pt"
 viewBox="0.00 0.00 88.59 188.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>perl6&#45;type&#45;graph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-184 84.59,-184 84.59,4 -4,4"/>
<!-- Scalar -->
<g id="node1" class="node">
<title>Scalar</title>
<g id="a_node1"><a xlink:href="/type/Scalar" xlink:title="Scalar">
<ellipse fill="none" stroke="#000000" cx="40.3" cy="-18" rx="40.09" ry="18"/>
<text text-anchor="middle" x="40.3" y="-14.3" font-family="FreeSans" font-size="14.00" fill="#000000">Scalar</text>
</a>
</g>
</g>
<!-- Any -->
<g id="node3" class="node">
<title>Any</title>
<g id="a_node3"><a xlink:href="/type/Any" xlink:title="Any">
<ellipse fill="none" stroke="#000000" cx="40.3" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="40.3" y="-86.3" font-family="FreeSans" font-size="14.00" fill="#000000">Any</text>
</a>
</g>
</g>
<!-- Scalar&#45;&gt;Any -->
<g id="edge1" class="edge">
<title>Scalar&#45;&gt;Any</title>
<path fill="none" stroke="#000000" d="M40.3,-36.3C40.3,-44.02 40.3,-53.29 40.3,-61.89"/>
<polygon fill="#000000" stroke="#000000" points="36.8,-61.9 40.3,-71.9 43.8,-61.9 36.8,-61.9"/>
</g>
<!-- Mu -->
<g id="node2" class="node">
<title>Mu</title>
<g id="a_node2"><a xlink:href="/type/Mu" xlink:title="Mu">
<ellipse fill="none" stroke="#000000" cx="40.3" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="40.3" y="-158.3" font-family="FreeSans" font-size="14.00" fill="#000000">Mu</text>
</a>
</g>
</g>
<!-- Any&#45;&gt;Mu -->
<g id="edge2" class="edge">
<title>Any&#45;&gt;Mu</title>
<path fill="none" stroke="#000000" d="M40.3,-108.3C40.3,-116.02 40.3,-125.29 40.3,-133.89"/>
<polygon fill="#000000" stroke="#000000" points="36.8,-133.9 40.3,-143.9 43.8,-133.9 36.8,-133.9"/>
</g>
</g>
</svg>

  <p class="fallback">
    <a
      rel="alternate"
      href="/images/type-graph-Scalar.svg"
      type="image/svg+xml"
      >Expand above chart</a
    >
  </p>
</figure>

        </div>
    </div>

    

    <footer class="pretty-box yellow">
        <p>
            Generated from <a href="https://github.com/Raku/doc/blob/master/doc/Type/Scalar.pod6">https://github.com/Raku/doc/blob/master/doc/Type/Scalar.pod6</a>.
        </p>
        <p>
            This is a work in progress to document Raku (formerly known as Perl 6), and
            known to be incomplete.
        </p>
        <p>
            <a href="https://github.com/raku/doc/blob/master/CONTRIBUTING.md#reporting-bugs">
                Please report any issues
            </a>
            Your contribution is appreciated.
        </p>
        <p>
            This documentation is provided under the terms of the
            <a href="https://raw.githubusercontent.com/raku/doc/master/LICENSE">
                Artistic License 2.0
            </a>. The Camelia image is
            <a href="https://raw.githubusercontent.com/raku/mu/master/misc/camelia.txt">
                copyright © 2009 by Larry Wall.
            </a>
            <!-- CREDITS -->
            <!--External Link Image by Zapyon, CCA-SA 4.0. Derived from Wikimedia Foundation https://commons.wikimedia.org/wiki/File:External-link-04-bold-12x12.svg -->
        </p>
    </footer>

    <script type="text/javascript" src="/Documentable/integration-test/js/app.js?v=1"></script>
    <script type="text/javascript" src="/Documentable/integration-test/js/search.js?v=3"></script>
</body>
</html>

