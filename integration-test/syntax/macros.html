<!doctype html>
<html lang="en">
<head>
    <title>macros macros</title>
    <meta charset="UTF-8"/>
    <meta name=viewport content="width=device-width, initial-scale=1">
    <link rel="icon" href="/Documentable/integration-test/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="/Documentable/integration-test/css/app.css" media="screen" title="default" />
    <noscript> <style> #search { visibility: hidden; } </style> </noscript>
</head>

<body class="pod">

    <div id="___top"></div>

    <div id="header" class="pretty-box green">

        <a href="/Documentable/integration-test/">
            <img src="/Documentable/integration-test/images/Camelia.svg"alt="»ö«"id="logo"width="62"height="48"/> &nbsp;Raku Documentation
        </a>

        <div id="search" class="ui-widget">
            <div class="green">
                <input placeholder="Loading..." id="query" accesskey="f" title="Enter term to search for (hit Esc to focus)"/>
            </div>
            <p id="not-found-message">
                Not in Index (<a href="" id="try-web-search">try site search</a>)
            </p>
        </div>
        
        <div class="menu">
            
            <div class="menu-items dark-green">
                <a class='menu-item darker-green' href='https://raku.org'><strong>Raku homepage</strong></a>
                    <a class="menu-item " href="/Documentable/integration-test/language.html"> Language </a>
                    <a class="menu-item " href="/Documentable/integration-test/type.html"> Types </a>
                    <a class="menu-item " href="/Documentable/integration-test/routine.html"> Routines </a>
                    <a class="menu-item " href="/Documentable/integration-test/programs.html"> Programs </a>
                    <a class="menu-item " href="https://webchat.freenode.net/?channels=#raku"> Chat with us </a>
            </div>
            
            
            
        
        </div>
    </div>

    <div id="content" class="pretty-box yellow content_fragment">

        <div align="right" style="display:none;">
            <button title="Edit this page"  class="pencil" onclick="location=''">
                <svg width="14px" height="16px" viewBox="0 0 14 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <defs></defs>
                    <g id="Octicons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <g id="pencil" fill="#000000">
                            <path d="M0,12 L0,15 L3,15 L11,7 L8,4 L0,12 L0,12 Z M3,14 L1,14 L1,12 L2,12 L2,13 L3,13 L3,14 L3,14 Z M13.3,4.7 L12,6 L9,3 L10.3,1.7 C10.69,1.31 11.32,1.31 11.71,1.7 L13.3,3.29 C13.69,3.68 13.69,4.31 13.3,4.7 L13.3,4.7 Z" id="Shape"></path>
                        </g>
                    </g>
                </svg>
            </button>
        </div>

        <h1 class="title">macros macros</h1>
        <p class="subtitle"></p>

        <nav class="indexgroup">
<table id="TOC">
<caption><h2 id="TOC_Title">Table of Contents</h2></caption>
    <tr class="toc-level-1"><td class="toc-number">1</td><td class="toc-text"><a href="#language_documentation_Experimental_features">language documentation Experimental features</a></td></tr>
   <tr class="toc-level-2"><td class="toc-number">1.1</td><td class="toc-text"><a href="#(Experimental_features)_macros_macros">(Experimental features) macros macros</a></td></tr>
                                                                         
</table>
</nav>

        <div class="pod-body ">
            <p>Documentation for macros <code>macros</code> assembled from the following types:</p>
<h1 id="language_documentation_Experimental_features"><a class="u" href="#___top" title="go to top of document">language documentation Experimental features</a></h1>
<p>From <a href="/Documentable/integration-test/language/experimental#macros">Experimental features</a></p>
<h2 id="(Experimental_features)_macros_macros"><a href="/Documentable/integration-test/language/experimental#macros">(Experimental features) macros macros</a></h2>
<p><a href="https://en.wikipedia.org/wiki/Macro_(computer_science)">Macros</a> are code-generating routines, that generate code in compile time, before the program is executed. In Raku its use is still experimental and it needs to be turned on via the pragma</p>
<pre class="pod-block-code">use experimental :macros;</pre>
<p>Macro processing happens during parsing time. A macro generates an abstract syntax tree, which is grafted into the program syntax tree. <code>quasi</code> is the routine that performs this task.</p>
<pre class="pod-block-code">macro does-nothing() {
    quasi {}
};
does-nothing; # OUTPUT: «»
</pre>
<p><a name="Documentable/integration-test/index-entry-quasi_(macros)"></a> Macros are a kind of routine, so they can take arguments in exactly the same way, and act also in almost the same way.</p>
<pre class="pod-block-code">macro is-mighty( $who ) {
    quasi { &quot;$who is mighty!&quot;}
};
say is-mighty &quot;Freija&quot;; # OUTPUT: « &quot;Freija&quot; is mighty!␤»
</pre>
<p><a name="Documentable/integration-test/index-entry-unquoting_(macros)"></a> <a name="Documentable/integration-test/index-entry-{{{}}}_(macros)"></a> &quot;Almost&quot; accounts for the fact that the argument is inserted as a literal, including the quotes. Please note that we can also eliminate the parentheses for a macro call, following the same rules as a routine. You can use the unquoting construct <code>{{{}}}</code> to get rid of this kind of thing:</p>
<pre class="pod-block-code">macro is-mighty( $who ) {
    quasi { {{{$who}}} ~ &quot; is mighty!&quot;}
};
say is-mighty &quot;Freija&quot;;  # OUTPUT: «Freija is mighty!␤»
</pre>
<p>Since macro expansion happens at parse time, care must be taken when using external variables in them:</p>
<pre class="pod-block-code">use experimental :macros;
my $called;
macro called() {
    $called++;
    quasi { &quot;Called&quot; }
};
say called() ~ &quot; $called times&quot;;
say called() ~ &quot; $called times&quot;; # OUTPUT: «Called 2 times␤Called 2 times␤»
</pre>
<p>Since macros are expanded at parse time, <code>$called</code> will be the result when runtime starts, which is already <code>2</code>, as printed. Initializing <code>$called</code> with 0, however, will make this print <code>Called 0 times</code> since that initialization is run <em>after</em> the parse phase, when the macros are expanded.</p>
<p>Macros are terribly useful when complicated, computed initializations need to be done. However, they are still in the <em>experimental</em> nursery for a good reason. Although the features shown above are not very likely to change, anything, even their very presence, might change at any one time depending in necessities, so it would be best to keep them away from production code. Meanwhile, taking a look at <a href="https://perl6advent.wordpress.com/2012/12/23/day-23-macros/">this article by Masak</a> as well as <a href="https://github.com/masak/007"><code>007</code></a>, a new macro language, might provide a glimpse into the things to come.</p>

        </div>
    </div>

    

    <footer class="pretty-box yellow">
        <p>
            Generated from <a href="https://github.com/Raku/doc/blob/master/doc/">https://github.com/Raku/doc/blob/master/doc/</a>.
        </p>
        <p>
            This is a work in progress to document Raku (formerly known as Perl 6), and
            known to be incomplete.
        </p>
        <p>
            <a href="https://github.com/raku/doc/blob/master/CONTRIBUTING.md#reporting-bugs">
                Please report any issues
            </a>
            Your contribution is appreciated.
        </p>
        <p>
            This documentation is provided under the terms of the
            <a href="https://raw.githubusercontent.com/raku/doc/master/LICENSE">
                Artistic License 2.0
            </a>. The Camelia image is
            <a href="https://raw.githubusercontent.com/raku/mu/master/misc/camelia.txt">
                copyright © 2009 by Larry Wall.
            </a>
            <!-- CREDITS -->
            <!--External Link Image by Zapyon, CCA-SA 4.0. Derived from Wikimedia Foundation https://commons.wikimedia.org/wiki/File:External-link-04-bold-12x12.svg -->
        </p>
    </footer>

    <script type="text/javascript" src="/Documentable/integration-test/js/app.js?v=1"></script>
    <script type="text/javascript" src="/Documentable/integration-test/js/search.js?v=3"></script>
</body>
</html>

